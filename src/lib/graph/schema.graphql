type Conversation @entity(immutable: false) {
	"The unique conversation ID"
	id: ID!

	"The wallet address of the owner"
	owner: Bytes!

	"The timestamp of the initial conversation creation"
	createdAt: BigInt!

	"The timestamp of the last metadata update (e.g., rename, delete)"
	lastUpdatedAt: BigInt!

	"The timestamp of the latest message added to this conversation. Used for sorting and syncing."
	lastMessageCreatedAt: BigInt!

	"A flag indicating if the conversation has been soft-deleted by the user"
	isDeleted: Boolean!

	"CID of the immutable ConversationFile on decentralised storage"
	conversationCID: String!

	"CID of the LATEST ConversationMetadataFile on decentralised storage"
	conversationMetadataCID: String!

	"A derived list of all messages within this conversation"
	messages: [Message!] @derivedFrom(field: "conversation")
}

type Message @entity(immutable: true) {
	"The unique message ID"
	id: ID!

	"A link to the parent Conversation entity"
	conversation: Conversation!

	"The timestamp of the message's creation"
	createdAt: BigInt!

	"The role of the message author: 'user' or 'assistant'"
	role: String!

	"CID of the MessageFile on decentralised storage"
	messageCID: String!

	"A derived link to the search delta associated with this message"
	searchDelta: SearchIndexDelta @derivedFrom(field: "message")
}

type SearchIndexDelta @entity(immutable: true) {
	"The ID, typically the same as the parent message ID"
	id: ID!

	"A link to the parent Message entity"
	message: Message!

	"CID of the SearchIndexDeltaFile on decentralised storage"
	searchDeltaCID: String!
}
